#!/bin/sh
# shellcheck disable=SC2016

# Set certain album items to singleton
beet ls -f '$id' -a last_import:1 | while read -r album_id; do
    beet modify -y "album_id:$album_id" singleton:0 album:@ singleton=1 2>/dev/null
    beet modify -y "album_id:$album_id" singleton:0 album:"non-album tracks" singleton=1 album= 2>/dev/null

    # Extract embedded album art if needed
    beet extractart -a "id:$album_id" artpath:@

    # Clear embedded album art
    beet clearart -y "album_id:$album_id"
done

# Clear out the album field for imported singletons
beet modify -y last_import:1 album::. album= 2>/dev/null

# 'Various Artists' albums not flagged as compilations
beet modify -y -a last_import:1 album_alias:is_various_not_comp comp=1 2>/dev/null
